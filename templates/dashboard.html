<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Okulus - Мониторинг рабочего времени</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <!-- Добавляем библиотеку SheetJS для экспорта в Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body {
            background: #f4f7fc;
        }

        .okulus-logo {
            max-width: 180px;
            margin-bottom: 1rem;
        }

        .nav-tabs .nav-link.active {
            background: #1e3a8a;
            color: #fff;
        }

        .nav-tabs .nav-link {
            color: #1e3a8a;
        }

        .metric-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.07);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .metric-title {
            color: #1e3a8a;
            font-weight: 600;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
        }

        .screenshot-thumb {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.08);
        }

        @media (max-width: 600px) {
            .metric-card {
                padding: 1rem;
            }
        }

        .website-card {
            background: #fff;
            border-radius: 8px;
            margin-bottom: 1rem;
            padding: 1rem;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .website-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .browser-icon {
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }

        .time-icon,
        .duration-icon {
            margin-right: 0.5rem;
            font-size: 0.9rem;
        }

        .website-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
            color: #666;
            font-size: 0.85rem;
        }

        .website-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 4px;
            color: #1e3a8a;
        }

        .website-url {
            font-family: monospace;
            word-break: break-all;
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: #555;
        }

        .url-text {
            font-family: monospace;
            word-break: break-all;
        }

        .browser-stats-card {
            background: #fff;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            height: auto;
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }

        .browser-stats-card h5 {
            margin-bottom: 1rem;
            color: #1e3a8a;
            font-weight: 600;
        }

        #browser-stats-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        #website-visits-list {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .table-responsive {
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        /* Стили для графиков */
        #website-activity-chart {
            width: 100%;
            min-height: 300px;
        }

        /* Исправление для отображения пустых данных */
        .alert-info {
            margin-top: 1rem;
        }

        /* Стили для ресурсов */
        .resource-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 1.25rem;
            display: flex;
            align-items: center;
            height: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .resource-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .resource-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .resource-icon i {
            font-size: 28px;
            color: white;
        }

        .cpu-icon {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }

        .ram-icon {
            background: linear-gradient(135deg, #0d6efd, #0dcaf0);
        }

        .disk-icon {
            background: linear-gradient(135deg, #198754, #20c997);
        }

        .gpu-icon {
            background: linear-gradient(135deg, #6610f2, #e83e8c);
        }

        .network-icon {
            background: linear-gradient(135deg, #0dcaf0, #0d6efd);
        }

        .keyboard-icon {
            background: linear-gradient(135deg, #fd7e14, #ffc107);
        }

        .resource-info {
            flex-grow: 1;
        }

        .resource-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #343a40;
        }

        .resource-metrics {
            margin-bottom: 0.5rem;
        }

        .current-usage {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .resource-progress {
            height: 8px;
            border-radius: 4px;
            background-color: #f0f0f0;
            margin-bottom: 0.5rem;
        }

        .resource-progress .progress-bar {
            border-radius: 4px;
        }

        #cpu-progress {
            background-color: #dc3545;
        }

        #ram-progress {
            background-color: #0d6efd;
        }

        #disk-progress {
            background-color: #198754;
        }

        #gpu-progress {
            background-color: #6610f2;
        }

        .resource-stats {
            display: flex;
            font-size: 0.875rem;
            color: #6c757d;
        }

        .stat-item {
            margin-right: 1rem;
        }

        .stat-label {
            font-weight: 600;
            margin-right: 0.25rem;
        }

        /* Стили для карточек графиков */
        .resource-chart-card,
        .resource-detail-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            height: 100%;
        }

        .resource-detail-card .card-title {
            font-weight: 600;
            color: #343a40;
            margin-bottom: 1rem;
        }

        .combined-chart-container {
            height: 400px;
        }

        .chart-container {
            min-height: 300px;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            margin-right: 0.5rem;
        }

        .cpu-color {
            background-color: #dc3545;
        }

        .ram-color {
            background-color: #0d6efd;
        }

        .disk-color {
            background-color: #198754;
        }

        .gpu-color {
            background-color: #6610f2;
        }

        .network-color {
            background-color: #0dcaf0;
        }

        .keyboard-color {
            background-color: #fd7e14;
        }

        .resource-detail-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
        }

        .detail-stat {
            background-color: #f8f9fa;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
        }

        .detail-stat-label {
            color: #6c757d;
            margin-right: 0.5rem;
        }

        .detail-stat-value {
            font-weight: 600;
            color: #343a40;
        }

        .chart-controls {
            font-size: 0.875rem;
        }

        /* Стили для табеля активности (BitCop стиль) */
        .time-intervals {
            font-size: 0.85rem;
            color: #666;
        }

        .timesheet-time-cell {
            min-width: 150px;
        }

        .timesheet-productivity-cell {
            min-width: 120px;
        }

        .time-range-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }

        .time-range {
            display: inline-block;
            font-size: 12px;
            background-color: #e9ecef;
            border-radius: 3px;
            padding: 1px 4px;
            color: #495057;
        }

        .productivity-badge {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            display: inline-block;
            font-weight: bold;
            min-width: 45px;
            text-align: center;
        }

        .day-productivity-high {
            color: #28a745;
        }

        .day-productivity-medium {
            color: #ffc107;
        }

        .day-productivity-low {
            color: #dc3545;
        }

        .timesheet-summary {
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
        }

        /* Дополнительные стили для карточек статистики */
        .browser-stats-card {
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            overflow: hidden;
        }

        .url-text {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: inline-block;
        }

        /* Стили для табеля активности */
        #detailed-timesheet {
            width: 100%;
        }

        .employee-header {
            background-color: #f0f0f0 !important;
        }

        .date-cell {
            width: 180px;
            white-space: nowrap;
        }

        .timesheet-time-cell {
            width: 180px;
        }

        .timesheet-productivity-cell {
            width: 200px;
        }

        .actions-cell {
            width: 70px;
            text-align: center;
        }

        /* Стили для текущего дня */
        .current-day {
            background-color: rgba(13, 110, 253, 0.05);
        }

        .current-day .date-display {
            font-weight: 600;
        }

        /* Стили для выходных дней */
        .weekend-day {
            background-color: rgba(108, 117, 125, 0.05);
        }

        /* Стили для отображения времени */
        .time-range-container {
            display: flex;
            height: 15px;
            width: 100%;
            background-color: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .time-range-hour {
            flex: 1;
            height: 100%;
            border-right: 1px solid #f8f9fa;
        }

        .time-range-hour:last-child {
            border-right: none;
        }

        .time-range-hour.active-hour {
            background-color: #6c757d;
        }

        /* Стили для продуктивности */
        .day-productivity-high {
            background-color: #28a745 !important;
        }

        .day-productivity-medium {
            background-color: #ffc107 !important;
        }

        .day-productivity-low {
            background-color: #dc3545 !important;
        }

        /* Стили для всплывающих подсказок */
        .tooltip {
            font-size: 0.875rem;
            opacity: 0.95 !important;
        }

        /* Стили для сводной информации */
        .timesheet-summary .card {
            border: none;
            box-shadow: none;
            margin-bottom: 0;
        }

        .timesheet-summary .card-header {
            background-color: #e9ecef;
        }

        .summary-block {
            background-color: #fff;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        .summary-block h6 {
            margin-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 0.5rem;
            font-weight: 600;
        }

        /* Стили для фильтров */
        .filter-card {
            margin-bottom: 1rem;
        }

        .filter-card .card-body {
            padding: 1rem;
        }

        .date-filters {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Стили для индикатора загрузки */
        .loading-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        /* Добавляем стиль для анимации зеркального блика на OCULUS */
        .logo-shine {
            position: relative;
            overflow: hidden;
        }

        .logo-shine::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to right,
                    rgba(255, 255, 255, 0) 0%,
                    rgba(255, 255, 255, 0.858) 50%,
                    rgba(255, 255, 255, 0) 100%);
            transform: rotate(30deg);
            animation: shine-effect 4s infinite;
            pointer-events: none;
        }

        @keyframes shine-effect {
            0% {
                transform: translateX(-100%) rotate(30deg);
            }

            20%,
            100% {
                transform: translateX(100%) rotate(30deg);
            }
        }

        .table-container {}

        .group-header {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%) !important;
            border-left: 4px solid #2196f3;
            transition: all 0.3s ease;
        }
        
        .group-header:hover {
            background: linear-gradient(135deg, #bbdefb 0%, #90caf9 100%) !important;
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);
        }
        
        .group-header-content {
            padding: 15px !important;
            border-radius: 8px;
        }
        
        .group-toggle {
            transition: transform 0.3s ease;
            color: #1976d2;
            font-size: 1.1em;
        }
        
        .group-summary {
            font-size: 0.9em;
        }
        
        .details-cell {
            max-width: 300px;
            padding: 8px 12px !important;
        }
        
        .details-container {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 8px;
            border-left: 3px solid #dee2e6;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 4px;
            line-height: 1.3;
        }
        
        .detail-item i {
            flex-shrink: 0;
        }
        
        .detail-item .fw-bold {
            color: #495057;
            min-width: 45px;
        }
        
        .badge {
            font-size: 0.75em;
            font-weight: 500;
        }
        
        .table tbody tr[data-parent-group] {
            border-left: 2px solid #e9ecef;
            transition: all 0.2s ease;
        }
        
        .table tbody tr[data-parent-group]:hover {
            background-color: #f8f9fa !important;
            border-left-color: #007bff;
        }
        
        .text-truncate {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        @media (max-width: 768px) {
            .group-summary {
                flex-direction: column;
                align-items: flex-start !important;
                gap: 8px !important;
            }
            
            .details-cell {
                max-width: 200px;
            }
        }

        .network-metrics {
            margin-bottom: 0.5rem;
        }

        .network-speed {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #0d6efd;
        }

        .network-traffic {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .traffic-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
        }

        .network-status {
            margin-top: 0.5rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .indicator-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .keyboard-metrics {
            margin-bottom: 0.5rem;
        }

        .keyboard-activity {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #fd7e14;
        }

        .keyboard-intensity {
            margin-bottom: 0.5rem;
        }

        .intensity-bar {
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.25rem;
        }

        .intensity-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #ffc107, #dc3545);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        #gpu-progress {
            background-color: #6610f2;
        }

        .resource-info {
            flex-grow: 1;
        }

        /* Стили для сетевых метрик */
        .network-metrics {
            margin-bottom: 0.5rem;
        }

        .network-speed {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #0dcaf0;
        }

        .network-traffic {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .traffic-item {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
            color: #6c757d;
        }

        .traffic-item i {
            margin-right: 0.25rem;
        }

        .network-status {
            margin-top: 0.5rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }

        .indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .indicator-dot.active {
            background-color: #198754;
            box-shadow: 0 0 4px rgba(25, 135, 84, 0.5);
        }

        .indicator-dot.inactive {
            background-color: #dc3545;
        }

        .keyboard-metrics {
            margin-bottom: 0.5rem;
        }

        .keyboard-activity {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #fd7e14;
        }

        .intensity-bar {
            height: 8px;
            background-color: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.25rem;
        }

        .intensity-fill {
            height: 100%;
            background-color: #fd7e14;
            transition: width 0.3s ease;
        }
    </style>
</head>

<body>
    <!-- Шапка -->
    <header class="header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <img src="/static/img/logo.gif" alt="Okulus" class="okulus-logo">
                    <div class="ms-3">
                        <h1 class="text-primary fw-bold mb-0 logo-shine">OCULUS</h1>
                        <h3 class="text-secondary mb-0">MONITORING DIES</h3>
                    </div>
                </div>
                <div class="d-flex align-items-center">
                    <div class="form-check form-switch me-3">
                        <input class="form-check-input" type="checkbox" id="auto-refresh-toggle">
                        <label class="form-check-label" for="auto-refresh-toggle">Автообновление</label>
                    </div>
                    <span class="text-muted me-3">Последнее обновление: <span id="last-update">-</span></span>
                    <button class="btn btn-outline-primary" onclick="refreshData()">
                        <i class="bi bi-arrow-clockwise"></i> Обновить
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Фильтры -->
        <div class="filters">
            <div class="row">
                <div class="col-md-3">
                    <div class="filter-input">
                        <label class="form-label">Сотрудник</label>
                        <select class="form-select" id="employee-filter" title="Выберите сотрудника" aria-label="Фильтр по сотруднику">
                            <option value="">Все сотрудники</option>
                            {% for employee in employees %}
                            <option value="{{ employee.id }}">{{ employee.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="filter-input">
                        <label class="form-label">Устройство</label>
                        <select class="form-select" id="device-filter" title="Выберите устройство" aria-label="Фильтр по устройству">
                            <option value="">Все устройства</option>
                            <!-- Заполняется динамически через JavaScript -->
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="filter-input">
                        <label class="form-label">Дата</label>
                        <input type="date" class="form-control" id="date-filter" title="Выберите дату" placeholder="Выберите дату" aria-label="Фильтр по дате">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="filter-input">
                        <label class="form-label">Период</label>
                        <select class="form-select" id="period-filter" title="Выберите период" aria-label="Фильтр по периоду">
                            <option value="day">День</option>
                            <option value="week">Неделя</option>
                            <option value="month">Месяц</option>
                        </select>
                    </div>
                    <div class="filter-input">
                        <label class="form-label">Тип активности</label>
                        <select class="form-select" id="activity-type-filter" title="Выберите тип активности" aria-label="Фильтр по типу активности">
                            <option value="all">Все</option>
                            <option value="productive">Продуктивная</option>
                            <option value="unproductive">Непродуктивная</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Основные метрики -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-title">Общее рабочее время</div>
                    <div class="metric-value" id="total-working-time">-</div>
                    <div class="metric-subtitle">За выбранный период</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-title">Продуктивное время</div>
                    <div class="metric-value" id="productive-time">-</div>
                    <div class="metric-subtitle">% от общего времени</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-title">Активность</div>
                    <div class="metric-value" id="activity-score">-</div>
                    <div class="metric-subtitle">Средний балл</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-title">Фон</div>
                    <div class="metric-value" id="break-time">-</div>
                    <div class="metric-subtitle">Общая продолжительность</div>
                </div>
            </div>
        </div>

        <!-- Вкладки -->
        <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="activity-tab" data-bs-toggle="tab" href="#activity" role="tab" aria-controls="activity" aria-selected="true">
                    <i class="bi bi-activity"></i> Активность
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="chronology-tab" data-bs-toggle="tab" href="#chronology" role="tab" aria-controls="chronology" aria-selected="false">
                    <i class="bi bi-calendar-check"></i> Хронология дня
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="browsers-tab" data-bs-toggle="tab" href="#browsers" role="tab" aria-controls="browsers" aria-selected="false">
                    <i class="bi bi-globe"></i> Браузеры
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="resources-tab" data-bs-toggle="tab" href="#resources" role="tab" aria-controls="resources" aria-selected="false">
                    <i class="bi bi-cpu"></i> Ресурсы
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="mouse-activity-tab" data-bs-toggle="tab" href="#mouse-activity" role="tab" aria-controls="mouse-activity" aria-selected="false">
                    <i class="bi bi-mouse"></i> Активность мыши
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="screenshots-tab" data-bs-toggle="tab" href="#screenshots" role="tab" aria-controls="screenshots" aria-selected="false">
                    <i class="bi bi-image"></i> Скриншоты
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="timesheet-tab" data-bs-toggle="tab" href="#timesheet" role="tab" aria-controls="timesheet" aria-selected="false">
                    <i class="bi bi-calendar-check"></i> Табель
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="activity-timesheet-tab" data-bs-toggle="tab" href="#activity-timesheet"
                    role="tab" aria-controls="activity-timesheet" aria-selected="false">
                    <i class="bi bi-file-earmark-bar-graph"></i> Табель активности
                </a>
            </li>
        </ul>

        <!-- Содержимое вкладок -->
        <div class="tab-content" id="dashboardTabsContent">
            <!-- Активность -->
            <div class="tab-pane fade show active" id="activity" role="tabpanel">
                <div class="row">
                    <div class="col-md-8">
                        <div class="chart-container">
                            <div id="activity-chart"></div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="table-container">
                            <h5 class="mb-3">Топ приложений</h5>
                            <table class="table" id="top-apps-table">
                                <thead>
                                    <tr>
                                        <th>Приложение</th>
                                        <th>Время</th>
                                        <th>%</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Хронология дня -->
            <div class="tab-pane fade" id="chronology" role="tabpanel">
                <div class="mt-4">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="metric-card">
                                <h5 class="mb-3"><i class="bi bi-calendar-check"></i> Хронометраж дня</h5>
                                <div class="mb-3">
                                    <div class="d-flex align-items-center">
                                        <label class="form-label me-2 mb-0">Дата:</label>
                                        <input type="date" class="form-control w-auto" id="chronology-date" title="Выберите дату для хронологии" placeholder="Выберите дату" aria-label="Дата для хронологии">
                                        <button class="btn btn-primary ms-2" id="load-chronology-btn"
                                            onclick="loadChronology()">Показать</button>
                                        <div class="ms-auto">
                                            <select id="chronology-sort" class="form-select form-select-sm w-auto" title="Порядок сортировки" aria-label="Сортировка хронологии">
                                                <option value="desc">От новых к старым</option>
                                                <option value="asc">От старых к новым</option>
                                            </select>
                                    </div>
                                </div>
                                </div>

                                <!-- Вкладки внутри хронологии -->
                                <ul class="nav nav-tabs mb-3" id="chronologySubTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="window-activity-tab" data-bs-toggle="tab"
                                            data-bs-target="#window-activity" type="button" role="tab"
                                            aria-controls="window-activity" aria-selected="true">
                                            <i class="bi bi-window"></i> Активность окон
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="window-focus-tab" data-bs-toggle="tab"
                                            data-bs-target="#window-focus" type="button" role="tab"
                                            aria-controls="window-focus" aria-selected="false">
                                            <i class="bi bi-eye-fill"></i> Фокус окон
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="websites-visited-tab" data-bs-toggle="tab"
                                            data-bs-target="#websites-visited" type="button" role="tab"
                                            aria-controls="websites-visited" aria-selected="false">
                                            <i class="bi bi-globe"></i> Посещенные сайты
                                        </button>
                                    </li>
                                </ul>

                                <div class="tab-content" id="chronologyTabContent">
                                    <!-- Вкладка активности окон -->
                                    <div class="tab-pane fade show active" id="window-activity" role="tabpanel"
                                        aria-labelledby="window-activity-tab">
                                        
                                        <!-- Описание вкладки -->
                                        <div class="alert alert-info mb-3">
                                            <i class="bi bi-info-circle"></i>
                                            <strong>Активность окон</strong> - показывает все процессы и приложения, включая фоновые. 
                                            Время отображается как есть, без фильтрации. Для расчета рабочего времени используются данные из главных метрик.
                                        </div>

                                        <!-- Кнопки управления спойлерами -->
                                        <div class="mb-3">
                                            <div class="btn-group btn-group-sm" role="group">
                                                <button type="button" class="btn btn-outline-primary"
                                                    onclick="toggleAllMajorPeriods(false)">
                                                    <i class="bi bi-chevron-down"></i> Развернуть все периоды
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary"
                                                    onclick="toggleAllMajorPeriods(true)">
                                                    <i class="bi bi-chevron-up"></i> Свернуть все периоды
                                                </button>
                                                <button type="button" class="btn btn-outline-info"
                                                    onclick="toggleAllMinorPeriods(false)">
                                                    <i class="bi bi-chevron-double-down"></i> Развернуть подпериоды
                                                </button>
                                                <button type="button" class="btn btn-outline-warning"
                                                    onclick="toggleAllMinorPeriods(true)">
                                                    <i class="bi bi-chevron-double-up"></i> Свернуть подпериоды
                                                </button>
                                            </div>
                                        </div>

                                <div class="table-responsive">
                                    <table class="table table-hover" id="chronology-table">
                                        <thead>
                                            <tr>
                                                <th style="width: 15%">Время</th>
                                                <th style="width: 20%">Приложение</th>
                                                <th style="width: 50%">Детали</th>
                                                <th style="width: 15%">Длительность</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                    <tr>
                                                        <td colspan="4" class="text-center">Выберите дату и нажмите
                                                            "Показать"</td>
                                                    </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                                    <!-- Новая вкладка: Фокус окон -->
                                    <div class="tab-pane fade" id="window-focus" role="tabpanel"
                                        aria-labelledby="window-focus-tab">
                                        
                                        <!-- Описание вкладки -->
                                        <div class="alert alert-success mb-3">
                                            <i class="bi bi-eye-fill"></i>
                                            <strong>Фокус окон</strong> - умный анализ активности с объединением данных. 
                                            Показывает слияние процессов по времени (±5 сек), активность мыши, загрузку ЦП и ОЗУ для каждого периода.
                                        </div>

                                        <!-- Режим отображения -->
                                        <div class="mb-3">
                                            <div class="row align-items-center">
                                                <div class="col-md-4">
                                                    <label for="focus-display-mode" class="form-label">
                                                        <i class="bi bi-layout-wtf"></i> Режим отображения:
                                                    </label>
                                                    <select class="form-select form-select-sm" id="focus-display-mode">
                                                        <option value="standard">Стандартный (по 5 минут)</option>
                                                        <option value="smart-spoilers">Умные спойлеры (периоды активности)</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-8">
                                                    <small class="text-muted">
                                                        <i class="bi bi-info-circle"></i>
                                                        <span id="display-mode-description">
                                                            Стандартный режим группирует записи по 5-минутным интервалам
                                                        </span>
                                                    </small>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Кнопки управления -->
                                        <div class="mb-3">
                                            <div class="btn-group btn-group-sm" role="group">
                                                <button type="button" class="btn btn-outline-success" id="analyze-focus-btn">
                                                    <i class="bi bi-cpu"></i> Анализировать фокус
                                                </button>
                                                <button type="button" class="btn btn-outline-primary" id="analyze-human-focus-btn">
                                                    <i class="bi bi-person-check"></i> Анализ человеческого фокуса
                                                </button>
                                                <button type="button" class="btn btn-outline-info" id="export-focus-btn">
                                                    <i class="bi bi-download"></i> Экспорт анализа
                                                </button>
                                            </div>
                                        </div>

                                        <div class="table-responsive">
                                            <table class="table table-hover" id="window-focus-table">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 12%">Время</th>
                                                        <th style="width: 18%">Приложение</th>
                                                        <th style="width: 25%">Детали</th>
                                                        <th style="width: 10%">Длительность</th>
                                                        <th style="width: 10%">Мышь</th>
                                                        <th style="width: 10%">ЦП</th>
                                                        <th style="width: 10%">ОЗУ</th>
                                                        <th style="width: 5%">Статус</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td colspan="8" class="text-center">Нажмите "Анализировать фокус" для начала анализа</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Вкладка посещенных сайтов -->
                                    <div class="tab-pane fade" id="websites-visited" role="tabpanel"
                                        aria-labelledby="websites-visited-tab">
                                <div class="table-responsive">
                                            <table class="table table-hover" id="chronology-websites-table">
                                        <thead>
                                            <tr>
                                                <th style="width: 15%">Время</th>
                                                <th style="width: 50%">Веб-сайт / Активность</th>
                                                <th style="width: 15%">Продуктивность</th>
                                                <th style="width: 20%">Действия</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                    <tr>
                                                        <td colspan="4" class="text-center">Нет данных о посещенных
                                                            сайтах</td>
                                                    </tr>
                                        </tbody>
                                    </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-4">
                                <div class="col-md-6">
                            <div class="metric-card">
                                <h5 class="mb-3"><i class="bi bi-window"></i> Программы</h5>
                                <div class="table-responsive">
                                    <table class="table table-hover" id="programs-activity-table">
                                        <thead>
                                            <tr>
                                                <th>Программа</th>
                                                <th>Время активности</th>
                                                <th>Количество запусков</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                    <tr>
                                                        <td colspan="3" class="text-center">Нет данных</td>
                                                    </tr>
                                        </tbody>
                                    </table>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="metric-card">
                                        <h5 class="mb-3"><i class="bi bi-folder2-open"></i> Активность в папках</h5>
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="folders-activity-table">
                                                <thead>
                                                    <tr>
                                                        <th>Папка</th>
                                                        <th>Время активности</th>
                                                        <th>Количество посещений</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td colspan="3" class="text-center">Нет данных</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Браузеры -->
            <div class="tab-pane fade" id="browsers" role="tabpanel">
                <div class="row mt-4">
                    <!-- Статистика браузеров -->
                    <div class="col-md-4">
                        <div class="browser-stats-card">
                            <h5 class="mb-3"><i class="bi bi-bar-chart-fill"></i> Статистика браузеров</h5>
                            <div id="browser-stats-container">
                                <div style="height: 300px;">
                                    <canvas id="browser-chart"></canvas>
                                </div>
                            <div class="mt-3">
                                <h6>Всего времени в браузерах</h6>
                                <div class="h3" id="total-browser-time">-</div>
                            </div>
                        </div>
                            <div id="no-browser-data" style="display: none;" class="alert alert-info">
                                Нет данных о использовании браузеров за выбранный период
                            </div>
                        </div>

                        <div class="browser-stats-card">
                            <h5 class="mb-3"><i class="bi bi-list-ul"></i> Топ браузеров</h5>
                            <div class="table-responsive">
                            <table class="table table-sm" id="top-browsers-table">
                                <thead>
                                    <tr>
                                        <th>Браузер</th>
                                        <th>Время</th>
                                        <th>%</th>
                                    </tr>
                                </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="3" class="text-center">Загрузка данных...</td>
                                        </tr>
                                    </tbody>
                            </table>
                            </div>
                        </div>
                    </div>

                    <!-- Посещенные сайты -->
                    <div class="col-md-8">
                        <div class="browser-stats-card">
                            <h5 class="mb-3"><i class="bi bi-globe2"></i> Посещенные веб-сайты</h5>
                            <div id="website-visits-container">
                                <div class="alert alert-info" id="no-website-visits">
                                    Нет данных о посещениях веб-сайтов за выбранный период
                                </div>
                                <div id="website-visits-list"></div>
                            </div>
                        </div>
                        <div class="browser-stats-card">
                            <h5 class="mb-3"><i class="bi bi-graph-up"></i> Активность посещений</h5>
                            <div id="website-activity-chart" style="height: 300px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ресурсы -->
            <div class="tab-pane fade" id="resources" role="tabpanel">
                <!-- Общие метрики -->
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="resource-card">
                            <div class="resource-icon cpu-icon">
                                <i class="bi bi-cpu"></i>
                            </div>
                            <div class="resource-info">
                                <h6 class="resource-title">Процессор (CPU)</h6>
                                <div class="resource-metrics">
                                    <div class="current-usage">
                                        <span id="current-cpu-usage">0</span>%
                                    </div>
                                    <div class="progress resource-progress">
                                        <div id="cpu-progress" class="progress-bar" role="progressbar"
                                            style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="resource-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Макс:</span>
                                        <span id="max-cpu-usage">0%</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Сред:</span>
                                        <span id="avg-cpu-usage">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="resource-card">
                            <div class="resource-icon ram-icon">
                                <i class="bi bi-memory"></i>
                            </div>
                            <div class="resource-info">
                                <h6 class="resource-title">Память (RAM)</h6>
                                <div class="resource-metrics">
                                    <div class="current-usage">
                                        <span id="current-ram-usage">0</span>%
                                    </div>
                                    <div class="progress resource-progress">
                                        <div id="ram-progress" class="progress-bar" role="progressbar"
                                            style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="resource-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Макс:</span>
                                        <span id="max-ram-usage">0%</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Сред:</span>
                                        <span id="avg-ram-usage">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="resource-card">
                            <div class="resource-icon disk-icon">
                                <i class="bi bi-hdd"></i>
                            </div>
                            <div class="resource-info">
                                <h6 class="resource-title">Диск</h6>
                                <div class="resource-metrics">
                                    <div class="current-usage">
                                        <span id="current-disk-usage">0</span>%
                                    </div>
                                    <div class="progress resource-progress">
                                        <div id="disk-progress" class="progress-bar" role="progressbar"
                                            style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="resource-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Макс:</span>
                                        <span id="max-disk-usage">0%</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Сред:</span>
                                        <span id="avg-disk-usage">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Дополнительные метрики ресурсов -->
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="resource-card">
                            <div class="resource-icon gpu-icon">
                                <i class="bi bi-gpu-card"></i>
                            </div>
                            <div class="resource-info">
                                <h6 class="resource-title">Видеокарта (GPU)</h6>
                                <div class="resource-metrics">
                                    <div class="current-usage">
                                        <span id="current-gpu-usage">0</span>%
                                    </div>
                                    <div class="progress resource-progress">
                                        <div id="gpu-progress" class="progress-bar" role="progressbar"
                                            style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="resource-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Макс:</span>
                                        <span id="max-gpu-usage">0%</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Сред:</span>
                                        <span id="avg-gpu-usage">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="resource-card">
                            <div class="resource-icon network-icon">
                                <i class="bi bi-wifi"></i>
                            </div>
                            <div class="resource-info">
                                <h6 class="resource-title">Сетевая активность</h6>
                                <div class="network-metrics">
                                    <div class="network-speed">
                                        <span id="current-network-speed">0</span> Mbps
                                    </div>
                                    <div class="network-traffic">
                                        <div class="traffic-item">
                                            <i class="bi bi-arrow-up text-success"></i>
                                            <span id="network-upload">0 MB</span>
                                        </div>
                                        <div class="traffic-item">
                                            <i class="bi bi-arrow-down text-primary"></i>
                                            <span id="network-download">0 MB</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="network-status">
                                    <div class="status-indicator">
                                        <div class="indicator-dot" id="network-indicator"></div>
                                        <span id="network-status-text">Подключено</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="resource-card">
                            <div class="resource-icon keyboard-icon">
                                <i class="bi bi-keyboard"></i>
                            </div>
                            <div class="resource-info">
                                <h6 class="resource-title">Активность клавиатуры</h6>
                                <div class="keyboard-metrics">
                                    <div class="keyboard-activity">
                                        <span id="keyboard-events-per-minute">0</span> соб/мин
                                    </div>
                                    <div class="keyboard-intensity">
                                        <div class="intensity-bar">
                                            <div class="intensity-fill" id="keyboard-intensity-bar"></div>
                                        </div>
                                        <small id="keyboard-intensity-text">Неактивна</small>
                                    </div>
                                </div>
                                <div class="resource-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Всего:</span>
                                        <span id="total-keyboard-events">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">За час:</span>
                                        <span id="keyboard-events-hour">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Графики ресурсов -->
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="resource-chart-card">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0"><i class="bi bi-graph-up"></i> Мониторинг ресурсов</h5>
                                <div class="chart-controls">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-primary active"
                                            id="chart-view-all">Все ресурсы</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            id="chart-view-cpu">CPU</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            id="chart-view-ram">RAM</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            id="chart-view-disk">Диск</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            id="chart-view-gpu">GPU</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            id="chart-view-network">Сеть</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            id="chart-view-keyboard">Клавиатура</button>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container combined-chart-container">
                                <div id="combined-resources-chart"></div>
                            </div>
                            <div class="chart-legend mt-2">
                                <div class="legend-item">
                                    <span class="legend-color cpu-color"></span>
                                    <span class="legend-label">CPU</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color ram-color"></span>
                                    <span class="legend-label">RAM</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color disk-color"></span>
                                    <span class="legend-label">Диск</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color gpu-color"></span>
                                    <span class="legend-label">GPU</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color network-color"></span>
                                    <span class="legend-label">Сеть</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color keyboard-color"></span>
                                    <span class="legend-label">Клавиатура</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Детальные карточки ресурсов -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="resource-detail-card">
                            <h5 class="card-title"><i class="bi bi-cpu"></i> Использование CPU</h5>
                        <div class="chart-container">
                            <div id="cpu-chart"></div>
                            </div>
                            <div class="resource-detail-stats">
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Пиковое использование:</span>
                                    <span class="detail-stat-value" id="peak-cpu">0%</span>
                                </div>
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Время пиковой нагрузки:</span>
                                    <span class="detail-stat-value" id="peak-cpu-time">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="resource-detail-card">
                            <h5 class="card-title"><i class="bi bi-memory"></i> Использование RAM</h5>
                        <div class="chart-container">
                            <div id="ram-chart"></div>
                        </div>
                            <div class="resource-detail-stats">
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Пиковое использование:</span>
                                    <span class="detail-stat-value" id="peak-ram">0%</span>
                                </div>
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Время пиковой нагрузки:</span>
                                    <span class="detail-stat-value" id="peak-ram-time">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="resource-detail-card">
                            <h5 class="card-title"><i class="bi bi-hdd"></i> Использование диска</h5>
                        <div class="chart-container">
                            <div id="disk-chart"></div>
                        </div>
                            <div class="resource-detail-stats">
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Пиковое использование:</span>
                                    <span class="detail-stat-value" id="peak-disk">0%</span>
                                </div>
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Время пиковой нагрузки:</span>
                                    <span class="detail-stat-value" id="peak-disk-time">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Дополнительные детальные карточки -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="resource-detail-card">
                            <h5 class="card-title"><i class="bi bi-gpu-card"></i> Использование GPU</h5>
                            <div class="chart-container">
                                <div id="gpu-chart"></div>
                            </div>
                            <div class="resource-detail-stats">
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Пиковое использование:</span>
                                    <span class="detail-stat-value" id="peak-gpu">0%</span>
                                </div>
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Время пиковой нагрузки:</span>
                                    <span class="detail-stat-value" id="peak-gpu-time">-</span>
                                </div>
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Температура:</span>
                                    <span class="detail-stat-value" id="gpu-temperature">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="resource-detail-card">
                            <h5 class="card-title"><i class="bi bi-wifi"></i> Сетевой трафик</h5>
                            <div class="chart-container">
                                <div id="network-chart"></div>
                            </div>
                            <div class="resource-detail-stats">
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Максимальная скорость:</span>
                                    <span class="detail-stat-value" id="peak-network-speed">0 Mbps</span>
                                </div>
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Общий трафик:</span>
                                    <span class="detail-stat-value" id="total-network-traffic">0 GB</span>
                                </div>
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Соотношение входящий/исходящий:</span>
                                    <span class="detail-stat-value" id="network-ratio">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="resource-detail-card">
                            <h5 class="card-title"><i class="bi bi-keyboard"></i> Активность клавиатуры</h5>
                            <div class="chart-container">
                                <div id="keyboard-chart"></div>
                            </div>
                            <div class="resource-detail-stats">
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Пиковая активность:</span>
                                    <span class="detail-stat-value" id="peak-keyboard-activity">0 соб/мин</span>
                                </div>
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Время пиковой активности:</span>
                                    <span class="detail-stat-value" id="peak-keyboard-time">-</span>
                                </div>
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Средняя активность:</span>
                                    <span class="detail-stat-value" id="avg-keyboard-activity">0 соб/мин</span>
                                </div>
                                <div class="detail-stat">
                                    <span class="detail-stat-label">Уровень интенсивности:</span>
                                    <span class="detail-stat-value" id="keyboard-intensity-level">Низкий</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Активность мыши -->
            <div class="tab-pane fade" id="mouse-activity" role="tabpanel">
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="metric-card">
                            <h5 class="mb-3"><i class="bi bi-mouse"></i> График активности мыши</h5>
                            <div id="mouse-chart-container">
                                <canvas id="mouse-activity-chart" height="400"></canvas>
                            </div>
                            <div id="no-mouse-data" style="display: none;" class="alert alert-info mt-3">
                                Нет данных об активности мыши за выбранный период
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="metric-card">
                            <h5 class="mb-3"><i class="bi bi-list-ul"></i> История активности мыши</h5>
                            <div class="table-responsive">
                                <table class="table table-striped" id="mouse-activity-table">
                                    <thead>
                                        <tr>
                                            <th>Время</th>
                                            <th>Клики</th>
                                            <th>Движения</th>
                                            <th>Устройство</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Данные добавляются динамически -->
                                        <tr>
                                            <td colspan="4" class="text-center">Загрузка данных...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Скриншоты -->
            <div class="tab-pane fade" id="screenshots" role="tabpanel">
                <div class="screenshot-grid" id="screenshot-grid"></div>
            </div>

            <!-- Табель -->
            <div class="tab-pane fade" id="timesheet" role="tabpanel">
                <div class="container-fluid mt-4">
                    <div class="row">
                        <div class="col-12">
                            <div class="card filter-card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <label for="timesheet-start-date" class="form-label">Период</label>
                                            <div class="input-group mb-3">
                                    <input type="date" class="form-control" id="timesheet-start-date" title="Начальная дата табеля" placeholder="Начальная дата" aria-label="Начальная дата табеля">
                                    <span class="input-group-text">-</span>
                                    <input type="date" class="form-control" id="timesheet-end-date" title="Конечная дата табеля" placeholder="Конечная дата" aria-label="Конечная дата табеля">
                                </div>
                            </div>
                                        <div class="col-lg-6">
                                            <label class="form-label">&nbsp;</label>
                                            <div class="d-flex mb-3 gap-2">
                                                <button class="btn btn-primary flex-fill" type="button"
                                                    id="show-timesheet-btn">
                                                    <i class="bi bi-search me-1"></i> Показать
                                                </button>
                                                <button class="btn btn-success" type="button" id="export-timesheet-btn"
                                                    title="Экспорт в Excel">
                                                    <i class="bi bi-file-excel"></i>
                                                </button>
                        </div>
                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Сводная информация по табелю -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Сводная информация</h5>
                                </div>
                                <div class="card-body">
                                    <div id="timesheet-summary">
                                        <div class="row">
                                            <div class="col-md-2">
                                                <div class="summary-item">
                                                    <div class="summary-label">Рабочих дней:</div>
                                                    <div class="summary-value" id="timesheet-work-days">0</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="summary-item">
                                                    <div class="summary-label">Общее время:</div>
                                                    <div class="summary-value" id="timesheet-total-time">0ч 0м</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="summary-item">
                                                    <div class="summary-label">Продуктивное время:</div>
                                                    <div class="summary-value" id="timesheet-productive-time">0ч 0м
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="summary-item">
                                                    <div class="summary-label">Продуктивность:</div>
                                                    <div class="summary-value" id="timesheet-productivity">0%</div>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="summary-item">
                                                    <div class="summary-label">В среднем в день:</div>
                                                    <div class="summary-value" id="timesheet-average-daily">0ч 0м</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Индикатор загрузки -->
                    <div class="row mt-4" id="timesheet-loading" style="display: none;">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body text-center p-5">
                                    <div class="d-flex justify-content-center">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Загрузка...</span>
                                        </div>
                                    </div>
                                    <div class="mt-3">Загрузка данных табеля...</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Контент табеля -->
                    <div id="timesheet-content">
                        <!-- Таблица табеля -->
                        <div class="row mb-4 mt-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Табель учёта рабочего времени</h5>
                                    </div>
                                    <div class="card-body p-0">
                                        <div id="timesheet-table-container">
                    <div class="table-responsive">
                                                <table class="table table-hover mb-0">
                                                    <thead class="table-light">
                                                        <tr>
                                                            <th style="width: 25%">Дата</th>
                                                            <th style="width: 20%">Время работы</th>
                                                            <th style="width: 20%">Продуктивность</th>
                                                            <th style="width: 25%">Приложения</th>
                                                            <th style="width: 10%">Действия</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="detailed-timesheet">
                                                        <tr>
                                                            <td colspan="5" class="text-center p-5">
                                                                <div class="alert alert-info" role="alert">
                                                                    <i class="bi bi-info-circle-fill me-2"></i>
                                                                    Выберите период и нажмите "Показать" для загрузки
                                                                    табеля
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Табель активности -->
    <div class="tab-pane fade" id="activity-timesheet" role="tabpanel" aria-labelledby="activity-timesheet-tab">
        <div class="container">
            <div class="mt-4">
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="metric-card">
                            <h5 class="mb-3"><i class="bi bi-calendar-range"></i> Период для табеля активности</h5>
                            <div class="d-flex align-items-center">
                                <input type="date" class="form-control me-2" id="activity-start-date" title="Начальная дата активности" placeholder="Начальная дата" aria-label="Начальная дата табеля активности">
                                <span class="me-2">-</span>
                                <input type="date" class="form-control me-2" id="activity-end-date" title="Конечная дата активности" placeholder="Конечная дата" aria-label="Конечная дата табеля активности">
                                <button class="btn btn-primary" id="load-activity-btn">
                                    <i class="bi bi-search"></i> Показать
                                </button>
                                <button class="btn btn-outline-primary ms-2" id="export-activity-btn">
                                    <i class="bi bi-file-earmark-excel"></i> Экспорт
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Сводные метрики (скрыты, так как они дублируют основные метрики) -->
                <div class="row mb-4" id="activity-summary-metrics" style="display: none;">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-title">Общее рабочее время</div>
                            <div class="metric-value" id="timesheet-total-time">-</div>
                            <div class="metric-subtitle">За выбранный период</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-title">Продуктивное время</div>
                            <div class="metric-value" id="timesheet-productive-time">-</div>
                            <div class="metric-subtitle">% от общего времени</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-title">Продуктивность</div>
                            <div class="metric-value" id="timesheet-productivity">-</div>
                            <div class="metric-subtitle">Средний балл</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-title">Фон</div>
                            <div class="metric-value" id="timesheet-break-time">-</div>
                            <div class="metric-subtitle">Общая продолжительность</div>
                        </div>
                    </div>
                </div>

                <!-- Таблица по дням -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-table"></i> Табель активности по дням</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0" id="activity-timesheet-table">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Дата</th>
                                                <th>День недели</th>
                                                <th>Общее время</th>
                                                <th>Продуктивность</th>
                                                <th>Топ приложения</th>
                                                <th>Топ сайты</th>
                                                <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                            <tr>
                                                <td colspan="7" class="text-center">Выберите период и нажмите "Показать"
                                                </td>
                                            </tr>
                            </tbody>
                        </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для скриншота -->
    <div class="modal fade" id="screenshotModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Скриншот</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть" title="Закрыть"></button>
                </div>
                <div class="modal-body">
                    <img src="" alt="Screenshot" class="img-fluid" id="modal-screenshot">
                    <div class="mt-3">
                        <p class="mb-1"><strong>Время:</strong> <span id="modal-time"></span></p>
                        <p class="mb-1"><strong>Приложение:</strong> <span id="modal-app"></span></p>
                        <p class="mb-0"><strong>Продуктивность:</strong> <span id="modal-productivity"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для веб-сайта -->
    <div class="modal fade" id="websiteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Детали посещения</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть" title="Закрыть"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-1"><strong>URL:</strong> <span id="modal-url" class="url-text"></span></p>
                    <p class="mb-1"><strong>Браузер:</strong> <span id="modal-browser"></span></p>
                    <p class="mb-1"><strong>Время:</strong> <span id="modal-website-time"></span></p>
                    <p class="mb-1"><strong>Сотрудник:</strong> <span id="modal-employee"></span></p>
                    <p class="mb-1"><strong>Компьютер:</strong> <span id="modal-computer"></span></p>
                    <p class="mb-0"><strong>IP-адрес:</strong> <span id="modal-ip"></span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Кнопка "Наверх" -->
    <button id="scroll-to-top-btn" title="Наверх" style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        cursor: pointer;
        display: none;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.4)'" 
       onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.3)'">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 19V5M5 12L12 5L19 12"></path>
        </svg>
    </button>

    <script>
        // Логика кнопки "Наверх"
        const scrollToTopBtn = document.getElementById('scroll-to-top-btn');
        
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                scrollToTopBtn.style.display = 'block';
            } else {
                scrollToTopBtn.style.display = 'none';
            }
        });
        
        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    </script>

    <!-- Скрипты -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/smart-screenshots.js"></script>
    <script src="/static/js/smart-network-metrics.js"></script>
    <script src="/static/js/smart-gpu-metrics.js"></script>
    <script src="/static/js/smart-keyboard-metrics.js"></script>
    <script src="/static/js/dashboard-timesheet.js"></script>
    <script src="/static/js/smart-time-calculator.js"></script>
    <script src="/static/js/smart-time-filter-fix.js"></script>
    <script src="/static/js/smart-time-filter-patch.js"></script>
    <script src="/static/js/smart-chronology-fix.js"></script>
    <script src="/static/js/quick-error-fix.js"></script>
    <script src="/static/js/browser-fix.js"></script>
    <script src="/static/js/browser-analytics.js"></script>
    <script src="/static/js/window-focus-analyzer.js"></script>
    <script src="/static/js/smart-spoiler-analyzer.js"></script>
    <!-- Анализатор человеческого фокуса внимания -->
    <script src="/static/js/human-focus-analyzer.js"></script>
    <script src="/static/js/focus-integration.js"></script>
    <script src="/static/js/smart-analytics-dashboard.js"></script>
    <!-- Было раньше -->
<!-- <script src="/static/js/dashboard.js"></script> -->

<!-- Стало: подключаем разбитый код по частям -->
	<script src="/static/js/1/1.js"></script>
	<script src="/static/js/1/2.js"></script>
	<script src="/static/js/1/3.js"></script>
    <script>
        // Подключаем дополнительные функции калькулятора
        if (typeof updateMainMetricsWithRealActivity === 'function') {
            window.smartCalculator = updateMainMetricsWithRealActivity;
        }
        
        // Инициализируем аналитику после загрузки всех скриптов
        if (typeof window.smartAnalytics !== 'undefined') {
            console.log('🔬 Подключаем продвинутую аналитику');
        }
        
        // Проверяем доступность анализатора человеческого фокуса
        if (typeof computeHumanFocusScore === 'function') {
            console.log('🧠 Анализатор человеческого фокуса загружен');
        }
        
        // Проверяем доступность интеграции фокуса
        if (typeof analyzeHumanFocusIntegrated === 'function') {
            console.log('🔗 Интеграция человеческого фокуса загружена');
        }
    </script>
</body>

</html>